{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/watcher.coffee"
  ],
  "names": [],
  "mappings": "AACA;EAAA;AAAA,MAAA,CAAA,EAAA,cAAA,EAAA,EAAA,EAAA,CAAA,EAAA,GAAA,EAAA,UAAA,EAAA,IAAA,EAAA,QAAA,EAAA,KAAA,EAAA,KAAA,EAAA,eAAA,EAAA,KAAA,EAAA,KAAA,EAAA,IAAA,EAAA,IAAA,EAAA,IAAA,EAAA,IAAA,EAAA,OAAA,EAAA,GAAA,EAAA,KAAA,EAAA,MAAA,EAAA,GAAA,EAAA,KAAA,EAAA,IAAA,EAAA,IAAA,EAAA,OAAA,EAAA,GAAA;;;EAIA,GAAA,GAA4B,OAAA,CAAQ,KAAR;;EAC5B,CAAA,CAAE,KAAF,EACE,KADF,EAEE,IAFF,EAGE,IAHF,EAIE,KAJF,EAKE,MALF,EAME,IANF,EAOE,IAPF,EAQE,OARF,CAAA,GAQ4B,GAAG,CAAC,GAAG,CAAC,WAAR,CAAoB,gBAApB,CAR5B;;EASA,CAAA,CAAE,GAAF,EACE,OADF,EAEE,IAFF,EAGE,GAHF,CAAA,GAG4B,GAAG,CAAC,GAHhC,EAdA;;;EAmBA,IAAA,GAA4B,OAAA,CAAQ,MAAR;;EAC5B,EAAA,GAA4B,OAAA,CAAQ,IAAR,EApB5B;;;;;;;;;;EA6BA,CAAA,CAAE,QAAF,EACE,cADF,EAEE,CAFF,CAAA,GAE4B,OAAA,CAAQ,WAAR,CAF5B;;EAGA,CAAA,CAAE,KAAF,EACE,KADF,EAEE,KAFF,CAAA,GAE4B,GAAG,CAAC,KAFhC,EAhCA;;;EAoCA,CAAA,GAA4B,CAAA;;EACzB,CAAA,QAAA,CAAA,CAAA;IACD,CAAC,CAAC,YAAF,GAAkB,IAAI,CAAC,OAAL,CAAa,SAAb;IAClB,CAAC,CAAC,QAAF,GAAkB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,YAAZ,EAA0B,KAA1B;WAClB,CAAC,CAAC,WAAF,GAAkB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,YAAZ,EAA0B,QAA1B;EAHjB,CAAA,IArCH;;;EA4CA,GAAA,GAGE,CAAA;;IAAA,QAAA,EAAU,QAAA,CAAA,CAAA;aAAG,CAAE,CAAF,CAAA,GAAA;eAAS,OAAA,CAAQ,GAAG,CAAC,QAAQ,CAAC,GAAb,CAAA,CAAR,EAA4B,SAA5B,EAAuC,UAAvC,EAAmD,CAAnD;MAAT;IAAH,CAAV;;IAGA,cAAA,EAAgB,QAAA,CAAA,CAAA;aAAG,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;QACjB,IAAc,CAAC,CAAC,GAAF,KAAS,KAAvB;UAAA,IAAA,CAAK,CAAL,EAAA;;QACA,CAAC,CAAC,GAAF,GAAQ;eACR,IAAA,CAAK,CAAL;MAHiB;IAAH,CAHhB;;IASA,cAAA,EAAgB,QAAA,CAAA,CAAA;aAAG,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;AACrB,YAAA;QAAI,IAAqB,cAArB;AAAA,iBAAO,IAAA,CAAK,CAAL,EAAP;;QACA,CAAA,GAAc,IAAI,CAAC,KAAL,CAAW,CAAC,CAAC,IAAb;QACd,CAAC,CAAC,IAAF,GAAc,CAAC,CAAC;QAChB,CAAC,CAAC,QAAF,GAAc,CAAC,CAAC;QAChB,CAAC,CAAC,SAAF,GAAc,CAAC,CAAC;QAChB,CAAC,CAAC,QAAF,GAAc,CAAC,CAAC;eAChB,IAAA,CAAK,CAAL;MAPiB;IAAH,CAThB;;IAmBA,aAAA,EAAe,QAAA,CAAA,CAAA;aAAG,KAAA,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;AACpB,YAAA,eAAA,EAAA,WAAA,EAAA,WAAA,EAAA,QAAA,EAAA;QAAI,IAAqB,CAAC,CAAC,GAAF,KAAS,QAA9B;AAAA,iBAAO,IAAA,CAAK,CAAL,EAAP;;QACA,IAAqB,CAAC,CAAC,SAAF,KAAe,KAApC;AAAA,iBAAO,IAAA,CAAK,CAAL,EAAP;;QAEA,CAAA,CAAA;;UAAE,CAAA,EAAG;QAAL,CAAA,GAAkB,CAAA,MAAM,MAAA,CAAQ,IAAR,CAAN,CAAlB;QACA,WAAA,GAAkB,CAAC,CAAC;QACpB,eAAA,GAAkB,CAAA,CAAA,CAAG,CAAC,CAAC,QAAL,CAAA,KAAA;QAClB,QAAA,GAAkB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,QAAZ,EAA0B,eAA1B;QAClB,WAAA,GAAkB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,WAAZ,EAA0B,eAA1B;QAClB,IAAA,CAAK,GAAG,CAAC,QAAQ,CAAC,GAAb,CAAA,CAAL,EAAyB,uBAAzB,EAAkD,GAAG,CAAC,GAAG,CAAC,OAAR,CAAgB,EAAA,CAAA,CAAI,CAAC,CAAC,QAAN,CAAA,IAAA,CAAA,CAAqB,eAArB,EAAA,CAAhB,CAAlD;QACA,MAAM,EAAE,CAAA,UAAA,CAAA,CAAe,QAAf,EAAA,CAAA,CAA2B,WAA3B,CAAA;QACR,MAAM,EAAE,CAAA,+BAAA,CAAA,CAAoC,QAApC,CAAA,GAAA,CAAA,CAAkD,WAAlD,CAAA;QACR,MAAM,EAAE,CAAA,MAAA,CAAA,CAAW,QAAX,CAAA;QACR,IAAA,CAAK,GAAG,CAAC,QAAQ,CAAC,GAAb,CAAA,CAAL,EAAyB,uBAAzB,EAAkD,GAAG,CAAC,GAAG,CAAC,OAAR,CAAgB,CAAA,IAAA,CAAA,CAAO,CAAC,CAAC,QAAT,CAAA,IAAA,CAAA,CAAwB,eAAxB,EAAA,CAAhB,CAAlD,EAZJ;;;AAeI,eAAO;MAhBS;IAAH;EAnBf,EA/CF;;;EAqFA,eAAA,GAAkB,QAAA,CAAA,CAAA;AAClB,QAAA;IAAE,QAAA,GAAkB,IAAI,cAAJ,CAAA,EAApB;;IAEE,QAAQ,CAAC,IAAT,CAAc,GAAG,CAAC,QAAJ,CAAA,CAAd;IACA,QAAQ,CAAC,IAAT,CAAc,GAAG,CAAC,cAAJ,CAAA,CAAd;IACA,QAAQ,CAAC,IAAT,CAAc,GAAG,CAAC,cAAJ,CAAA,CAAd,EAJF;;IAME,QAAQ,CAAC,IAAT,CAAc,GAAG,CAAC,aAAJ,CAAA,CAAd;AACA,WAAO;EARS,EArFlB;;;EAiGM,aAAN,MAAA,WAAA,QAAyB,GAAG,CAAC,KAAK,CAAC,QAAnC,CAAA;;IAGE,WAAa,CAAE,QAAF,CAAA;WACX,CAAM;QAAE,OAAA,EAAS;MAAX,CAAN;MACA,IAAC,CAAA,QAAD,GAAY;AACZ,aAAO;IAHI,CADf;;;IAOU,MAAR,MAAQ,CAAE,GAAF,EAAO,IAAP,CAAA;AACV,UAAA,CAAA,EAAA,GAAA;;MACI,IAAC,CAAA,QAAQ,CAAC,IAAV,CAAe,CAAE,GAAF,EAAO,IAAP,CAAf;AACA;MAAA,oBAAA;QAAA;MAAA;AACA,aAAO;IAJD;;EATV,EAjGA;;;EAiHA,IAAA,GAAO,QAAA,CAAA,CAAA;WAAG,IAAI,OAAJ,CAAY,KAAA,CAAE,OAAF,EAAW,MAAX,CAAA,GAAA;AACtB,UAAA,eAAA,EAAA,UAAA,EAAA,UAAA,EAAA;MAAE,OAAA,GAAoB,IAAI,UAAJ,CAAe,eAAA,CAAA,CAAf;MACpB,OAAO,CAAC,QAAR,CAAiB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,YAAZ,EAA0B,eAA1B,CAAjB;MACA,OAAO,CAAC,QAAR,CAAiB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,YAAZ,EAA0B,iBAA1B,CAAjB;MACA,OAAO,CAAC,QAAR,CAAiB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,YAAZ,EAA0B,gBAA1B,CAAjB;MACA,OAAO,CAAC,QAAR,CAAiB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,YAAZ,EAA0B,kBAA1B,CAAjB;MACA,MAAM,KAAA,CAAM,GAAN,EAAW,QAAA,CAAA,CAAA;AACf,eAAO,OAAA,CAAA;MADQ,CAAX;AAEN,aAPF;;MASE,UAAA,GAAoB,IAAI,CAAC,IAAL,CAAU,WAAV,EAAuB,WAAvB;MACpB,eAAA,GAAoB,IAAI,CAAC,IAAL,CAAU,WAAV,EAAuB,KAAvB;MACpB,UAAA,GAAoB,IAAI,CAAC,IAAL,CAAU,WAAV,EAAuB,eAAvB,EAXtB;;;MAcE,EAAE,CAAC,aAAH,CAAiB,UAAjB,EAA6B,MAA7B;MACA,EAAE,CAAC,SAAH,CAAa,eAAb;MACA,EAAE,CAAC,aAAH,CAAiB,UAAjB,EAA6B,MAA7B;MACA,MAAM,KAAA,CAAM,IAAN;MACN,EAAE,CAAC,aAAH,CAAiB,UAAjB,EAA6B,YAA7B;MACA,EAAE,CAAC,aAAH,CAAiB,UAAjB,EAA6B,MAA7B;MACA,MAAM,KAAA,CAAM,IAAN;MACN,EAAE,CAAC,aAAH,CAAiB,UAAjB,EAA6B,MAA7B;MACA,EAAE,CAAC,MAAH,CAAU,UAAV;MACA,EAAE,CAAC,SAAH,CAAa,eAAb;MACA,KAAA,CAAM,IAAN,EAAY,KAAA,CAAA,CAAA,GAAA;QACV,KAAA,CAAM,GAAG,CAAC,QAAQ,CAAC,GAAb,CAAA,CAAN,EAA0B,SAA1B,EAAqC,kBAArC;QACA,MAAM,OAAO,CAAC,IAAR,CAAA;QACN,KAAA,CAAM,GAAG,CAAC,QAAQ,CAAC,GAAb,CAAA,CAAN,EAA0B,SAA1B,EAAqC,CAAA,SAAA,CAAA,CAAY,WAAZ,CAAA,CAArC;;UACA;;eACA,OAAA,CAAA;MALU,CAAZ,EAxBF;;AA+BE,aAAO,KA/BT;;aAiCE,OAAA,CAAA;IAlCoB,CAAZ;EAAH,EAjHP;;;EAuJA,IAAG,OAAO,CAAC,IAAR,KAAgB,MAAnB;IAAkC,CAAA,KAAA,CAAA,CAAA,GAAA;aAChC,CAAA,MAAM,IAAA,CAAA,CAAN;IADgC,CAAA,IAAlC;;;EAvJA;AAAA",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'GUY/temp/tests'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n#...........................................................................................................\nPATH                      = require 'path'\nFS                        = require 'fs'\n# { freeze }                = require 'letsfreezethat'\n# H                         = require './helpers'\n# types                     = new ( require 'intertype' ).Intertype()\n# { isa\n#   declare\n#   type_of\n#   validate\n#   equals }                = types\n{ Pipeline\n  Async_pipeline\n  $         }             = require 'moonriver'\n{ after\n  defer\n  sleep }                 = GUY.async\n#...........................................................................................................\nG                         = {}\ndo ->\n  G.project_path  = PATH.dirname __dirname\n  G.tmp_path      = PATH.join G.project_path, 'tmp'\n  G.public_path   = PATH.join G.project_path, 'public'\n\n\n#===========================================================================================================\nxxx =\n\n  #---------------------------------------------------------------------------------------------------------\n  $log_all: -> ( d ) => whisper GUY.datetime.now(), '^858-4^', 'pipeline', d\n\n  #---------------------------------------------------------------------------------------------------------\n  $add_as_change: -> ( d, send ) =>\n    send d unless d.key is 'add'\n    d.key = 'change'\n    send d\n\n  #---------------------------------------------------------------------------------------------------------\n  $add_file_info: -> ( d, send ) =>\n    return send d unless d.path?\n    e           = PATH.parse d.path\n    d.home      = e.dir\n    d.filename  = e.base\n    d.extension = e.ext\n    d.barename  = e.name\n    send d\n\n  #---------------------------------------------------------------------------------------------------------\n  $html_from_md: -> ( d, send ) =>\n    return send d unless d.key is 'change'\n    return send d unless d.extension is '.md'\n    #.......................................................................................................\n    { $: zx }       = await import( 'zx' )\n    source_path     = d.path\n    public_filename = \"#{d.barename}.html\"\n    tmp_path        = PATH.join G.tmp_path,     public_filename\n    public_path     = PATH.join G.public_path,  public_filename\n    help GUY.datetime.now(), '^$html_from_md@858-4^', GUY.trm.reverse \" #{d.filename} -> #{public_filename} \"\n    await zx\"\"\"pandoc -o #{tmp_path} #{source_path}\"\"\"\n    await zx\"\"\"echo '<!DOCTYPE html>' | cat - #{tmp_path} > #{public_path}\"\"\"\n    await zx\"\"\"trash #{tmp_path}\"\"\"\n    info GUY.datetime.now(), '^$html_from_md@858-4^', GUY.trm.reverse \" OK #{d.filename} -> #{public_filename} \"\n      # date +\"%Y-%m-%d %H:%M:%S\"\n    #.......................................................................................................\n    return null\n\n#===========================================================================================================\ncreate_pipeline = ->\n  pipeline        = new Async_pipeline()\n  # pipeline.push ( d ) -> warn GUY.datetime.now(), '^858-4^', 'pipeline', d\n  pipeline.push xxx.$log_all()\n  pipeline.push xxx.$add_as_change()\n  pipeline.push xxx.$add_file_info()\n  # pipeline.push xxx.$log_all()\n  pipeline.push xxx.$html_from_md()\n  return pipeline\n\n\n#===========================================================================================================\nclass My_watcher extends GUY.watch.Watcher\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( pipeline ) ->\n    super { ignored: /(^|\\/)\\..|node_modules/, }\n    @pipeline = pipeline\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  on_all: ( key, path ) ->\n    # whisper GUY.datetime.now(), '^858-1^', 'my_watcher', key, path\n    @pipeline.send { key, path, }\n    null for await d from @pipeline.walk()\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\ndemo = -> new Promise ( resolve, reject ) =>\n  watcher           = new My_watcher create_pipeline()\n  watcher.add_path PATH.join G.project_path, 'pages/**/*.md'\n  watcher.add_path PATH.join G.project_path, 'public/**/*.css'\n  watcher.add_path PATH.join G.project_path, 'public/**/*.js'\n  watcher.add_path PATH.join G.project_path, 'public/**/*.html'\n  await after 100, ->\n    return resolve()\n  return\n  #.......................................................................................................\n  new_path_1        = PATH.join folder_path, 'new_1.txt'\n  new_folder_path   = PATH.join folder_path, 'sub'\n  new_path_2        = PATH.join folder_path, 'sub/new_2.txt'\n  #.......................................................................................................\n  # await sleep 0.25\n  FS.writeFileSync new_path_1, 'helo'\n  FS.mkdirSync new_folder_path\n  FS.writeFileSync new_path_2, 'helo'\n  await sleep 0.25\n  FS.writeFileSync new_path_1, 'sfhsoifhas'\n  FS.writeFileSync new_path_2, 'helo'\n  await sleep 0.25\n  FS.writeFileSync new_path_2, 'helo'\n  FS.rmSync new_path_2\n  FS.rmdirSync new_folder_path\n  after 0.25, =>\n    debug GUY.datetime.now(), '^858-5^', \"stopping watcher\"\n    await watcher.stop()\n    debug GUY.datetime.now(), '^858-6^', \"removing #{folder_path}\"\n    rm?()\n    resolve()\n    # return null\n  return null\n  #.........................................................................................................\n  resolve()\n\n\n############################################################################################################\nif require.main is module then do =>\n  await demo()\n  # await demo_zx()\n\n"
  ]
}