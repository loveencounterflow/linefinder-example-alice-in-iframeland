{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/ops2.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\nglobalThis.log = console.log\nglobalThis.debug = console.debug\n\n\n#-----------------------------------------------------------------------------------------------------------\nadd_line_markers = ( ref_element, element ) ->\n  debug 'add_line_markers', element\n  # debug '^32342^', µ.DOM.select_all_from element, '.µ-clientrec'\n  µ.DOM.remove marker for marker in µ.DOM.select_all_from element, '.µ-clientrec'\n  #.........................................................................................................\n  ref_rectangle = ref_element.getBoundingClientRect()\n  #.........................................................................................................\n  for rectangle, idx in element.getClientRects()\n    scroll_top                = 0 # -element.scrollTop\n    scroll_left               = 0 # -element.scrollLeft\n    # scroll_top                = µ.DOM.get_document_scroll_top()\n    # scroll_left               = µ.DOM.get_document_scroll_left()\n    marker_top                = rectangle.top     - ref_rectangle.top  + ref_element.scrollTop\n    # if idx is 0\n    #   debug '^123-1^', marker_top, rectangle.top, ref_rectangle.top, ref_element.scrollTop\n    marker_left               = rectangle.left    - ref_rectangle.left\n    marker_width              = rectangle.width\n    marker_height             = rectangle.height\n    marker_bottom             = marker_top        + marker_height\n    # marker                    = µ.DOM.parse_one \"<div>#{marker_top.toFixed 0}px</div>\"\n    marker                    = µ.DOM.parse_one \"<div></div>\"\n    marker.style.top          = \"#{ marker_top    }px\"\n    marker.style.left         = \"#{ marker_left   }px\"\n    marker.style.width        = \"#{ marker_width  }px\"\n    marker.style.height       = \"#{ marker_height }px\"\n    marker.style.paddingLeft  = \"#{ marker_width  }px\"\n    µ.DOM.add_class marker, 'µ-clientrec'\n    µ.DOM.add_class marker, 'above' if marker_top     < 0\n    µ.DOM.add_class marker, 'below' if marker_bottom  > ref_rectangle.height\n    ref_element.appendChild marker\n  # µ.DOM.remove m2 for m2 in µ.DOM.select_all_from ref_element, '.µ-clientrec.ref-rectangle'\n  # m2 = document.createElement 'div'\n  # µ.DOM.add_class m2, 'µ-clientrec'\n  # µ.DOM.add_class m2, 'ref-rectangle'\n  # m2.style.top    = \"#{0}px\"\n  # m2.style.left   = \"#{0}px\"\n  # m2.style.width  = \"#{ref_rectangle.width}px\"\n  # m2.style.height = \"#{ref_rectangle.height}px\"\n  # ref_element.appendChild m2\n  return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# draw_client_rectangles = =>\n#   ref_elements = µ.DOM.select_all '.tracker'\n#   for ref_element in ref_elements\n#     debug \"draw_client_rectangles for ref_element\", ref_element\n#     elements = µ.DOM.select_all_from ref_element, '& > div > span'\n#     for element in elements\n#       # debug '^123-2^', element\n#       add_line_markers ref_element, element\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# do ->\n#   for element in µ.DOM.select_all '.tracker > div'\n#     µ.DOM.wrap_inner element, µ.DOM.parse_one '<span></span>'\n#   return null\n\n\n#===========================================================================================================\nclass Aligner\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ->\n    @_insert_spans()\n    @_mark_line_rectangles()\n    @_xxx()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _insert_spans: ->\n    ### all relevant iframes show the same underlying document so we only add spans for the document in the\n    first iframe ###\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    for element in first_tracker.querySelectorAll ':scope > div'\n      # debug '^123-3^', element\n      µ.DOM.wrap_inner element, µ.DOM.parse_one \"<span class='µ-aligner'></span>\"\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _mark_line_rectangles: ->\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    debug \"draw_client_rectangles for first_tracker\", first_tracker\n    elements = first_tracker.querySelectorAll ':scope > div > span'\n    for element in elements\n      # debug '^123-4^', element\n      add_line_markers first_tracker, element\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _xxx: ->\n    ###\n\n    entities:\n\n      * iframes / target boxes\n        * linearly ordered so text flows from one to the next\n          * each with width, height, position on page\n        * for now:\n          * no automatic creation\n          * width held constant across iframes\n          * position on page irrelevant\n\n      * galley:\n        * has maximum width of all target frames\n        * has margins above, below of at least the maximum target height\n        * extensions:\n          * when one flow should go into targets with differing widths, need to add\n            floating divs left and right to constrain and position lines using CSS\n            `shape-outside` (and analogous `clip-path` for visualization)\n            `d.style.setProperty( '--path', getComputedStyle(d).getPropertyValue('--path') + ', 20mm 50mm' )`\n\n    ###\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ref_element   = first_tracker\n    ref_rectangle = ref_element.getBoundingClientRect()\n    elements      = first_tracker.querySelectorAll ':scope > div > span'\n    for element in elements\n      debug '^123-5^', element\n      for rectangle, idx in element.getClientRects()\n        scroll_top                = 0 # -element.scrollTop\n        scroll_left               = 0 # -element.scrollLeft\n        # scroll_top                = µ.DOM.get_document_scroll_top()\n        # scroll_left               = µ.DOM.get_document_scroll_left()\n        marker_top                = rectangle.top     - ref_rectangle.top  + ref_element.scrollTop\n        if idx is 0\n          debug '^123-6^', marker_top, rectangle.top, ref_rectangle.top, ref_element.scrollTop\n        marker_left               = rectangle.left    - ref_rectangle.left\n        marker_width              = rectangle.width\n        marker_height             = rectangle.height\n        marker_bottom             = marker_top        + marker_height\n    return null\n\n\n#===========================================================================================================\nnext_slug = ( walker ) -> d = walker.next(); { slug: d.value, slugs_done: d.done, }\nnext_node = ( walker ) -> d = walker.next(); { node: d.value, nodes_done: d.done, }\n\n\n#===========================================================================================================\nµ.DOM.ready ->\n  log '^123-8^', \"ready\"\n  #.........................................................................................................\n  if µ.DOM.page_is_inside_iframe()\n    log '^123-9^', \"leaving b/c document is loaded in iframe\"\n    return null\n  #.........................................................................................................\n  unless ( galley_iframe = µ.DOM.select_first 'iframe', null )?\n    log '^123-10^', \"leaving b/c document does not have iframes\"\n    return null\n  #.........................................................................................................\n  ### Allow user-scrolling for demo ###\n  for iframe in µ.DOM.select_all 'iframe'\n    µ.DOM.set iframe, 'scrolling', 'true'\n  #.........................................................................................................\n  galley_height     = µ.DOM.get_height galley_iframe\n  galley_document   = galley_iframe.contentDocument\n  galley_window     = galley_iframe.contentWindow\n  #.........................................................................................................\n  galley_window.scrollTo { left:0, top: 0, }\n  #.........................................................................................................\n  node_walker       = ( galley_document.querySelectorAll 'galley > div' ).values()\n  linefinder        = new galley_window.µ.LINEFINDER.Linefinder()\n  #.........................................................................................................\n  xxx_count         = 0\n  state             =\n    first_slug:   null\n    top:          null\n  #.........................................................................................................\n  loop\n    break if xxx_count++ > 500 ### !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ###\n    { node\n      nodes_done    } = next_node node_walker\n    log '^123-1^', node, nodes_done\n    #.......................................................................................................\n    if nodes_done\n      # might want to mark galleys without content at this point\n      break\n    #.......................................................................................................\n    slug_walker       = linefinder.walk_slugs_of_node node\n    loop\n      break if xxx_count++ > 500 ### !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ###\n      { slug\n        slugs_done  } = next_slug slug_walker\n      #.......................................................................................................\n      unless state.first_slug?\n        state.first_slug    = slug\n        state.top           = state.first_slug.rectangle.top + galley_document.documentElement.scrollTop\n        galley_window.scrollTo { top: state.top, }\n      linefinder.draw_box slug.rectangle\n      break if slugs_done\n      # bottom    = slug.rectangle.bottom + galley_document.documentElement.scrollTop\n      # distance  = bottom - top\n      # log '^123-13^', { bottom, distance, galley_height, }\n  return null\n\n\n\n###\n  button  = µ.DOM.select_first '#redraw'\n  µ.DOM.on button, 'click', ->\n    debug '^123-14^', \"redraw\"\n    draw_client_rectangles()\n  return null\n###\n\n\n\n"
  ]
}