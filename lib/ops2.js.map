{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/ops2.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\nglobalThis.log = console.log\nglobalThis.debug = console.debug\n\n\n\n\n\n#===========================================================================================================\nclass Column\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( ø_iframe, ø_slug ) ->\n    @_ø_iframe  = ø_iframe\n    @first_slug = ø_slug.value\n    @top        = ø_slug.value.rectangle.top\n    @height     = 0\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  scroll_to_first_line: ->\n    @_ø_iframe.galley_window.scrollTo { top: @top, }\n    return null\n\n\n#===========================================================================================================\nclass Walker\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( iterator, stop = null ) ->\n    @_iterator  = iterator\n    @_stop      = stop\n    @done       = false\n    @value      = stop\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  step: ->\n    { value, done, } = @_iterator.next()\n    if done\n      @done   = true\n      @value  = @_stop\n      return @_stop\n    @value = value\n    return value\n\n\n#===========================================================================================================\nclass Node_walker extends Walker\nclass Slug_walker extends Walker\n\n\n#===========================================================================================================\nclass Iframe_walker extends Walker\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( iterator, stop = null ) ->\n    super iterator, stop\n    @height                 = null\n    @galley_document        = null\n    @galley_window          = null\n    @galley_draw_box        = null\n    @galley_draw_line_cover = null\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  step: ->\n    super()\n    return @_stop if @done\n    @height                 = µ.DOM.get_height @value\n    @galley_document        = @value.contentDocument\n    @galley_window          = @value.contentWindow\n    ### TAINT may want to return `linefinder` itself ###\n    local_linefinder        = new @value.contentWindow.µ.LINEFINDER.Linefinder()\n    @galley_draw_box        = local_linefinder.draw_box.bind            local_linefinder\n    @galley_draw_line_cover = local_linefinder.xxx_draw_line_cover.bind local_linefinder\n    return @value\n\n\n#===========================================================================================================\nµ.DOM.ready ->\n  log '^123-8^', \"ready\"\n  #.........................................................................................................\n  if µ.DOM.page_is_inside_iframe()\n    log '^123-9^', \"leaving b/c document is loaded in iframe\"\n    return null\n  #.........................................................................................................\n  _iframes = µ.DOM.select_all 'iframe'\n  unless _iframes.length > 0\n    log '^123-10^', \"leaving b/c document does not have iframes\"\n    return null\n  #.........................................................................................................\n  ### Allow user-scrolling for demo ###\n  # µ.DOM.set ø_iframe.value, 'scrolling', 'true' for ø_iframe.value in µ.DOM.select_all 'ø_iframe.value'\n  #.........................................................................................................\n  ø_iframe          = new Iframe_walker _iframes.values()\n  ø_iframe.step()\n  _nodes            = ø_iframe.galley_document.querySelectorAll 'galley > p'\n  ø_node            = new Node_walker _nodes.values()\n  linefinder        = new ø_iframe.galley_window.µ.LINEFINDER.Linefinder()\n  column            = null\n  #.........................................................................................................\n  loop\n    break if ø_iframe.done\n    #.......................................................................................................\n    unless ø_node.step()? # might want to mark galleys without content at this point\n      log '^123-1^', \"nodes done\"; break\n    #.......................................................................................................\n    ø_slug = new Slug_walker linefinder.walk_slugs_of_node ø_node.value\n    loop\n      unless ø_slug.step()?\n        log '^123-1^', \"slugs done\"; break\n      #.......................................................................................................\n      unless column?.first_slug?\n        column = new Column ø_iframe, ø_slug\n        column.scroll_to_first_line()\n      #.......................................................................................................\n      column.height = ø_slug.value.rectangle.bottom - column.top\n      if ø_iframe.height > column.height\n        ø_iframe.galley_draw_box ø_slug.value.rectangle\n        continue\n      #.......................................................................................................\n      ø_iframe.galley_draw_line_cover ø_slug.value.rectangle\n      column    = null\n      unless ø_iframe.step()?\n        log '^123-1^', \"iframes done\"; break\n      ø_iframe.galley_draw_box ø_slug.value.rectangle\n      column = new Column ø_iframe, ø_slug\n      column.scroll_to_first_line()\n  return null\n\n\n\n###\n  button  = µ.DOM.select_first '#redraw'\n  µ.DOM.on button, 'click', ->\n    debug '^123-14^', \"redraw\"\n    draw_client_rectangles()\n  return null\n###\n\n\n\n"
  ]
}