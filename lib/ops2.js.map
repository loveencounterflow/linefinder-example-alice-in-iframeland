{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/ops2.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\nglobalThis.log = console.log\nglobalThis.debug = console.debug\n\n\n#-----------------------------------------------------------------------------------------------------------\nadd_line_markers = ( ref_element, element ) ->\n  debug 'add_line_markers', element\n  # debug '^32342^', µ.DOM.select_all_from element, '.µ-clientrec'\n  µ.DOM.remove marker for marker in µ.DOM.select_all_from element, '.µ-clientrec'\n  #.........................................................................................................\n  ref_rectangle = ref_element.getBoundingClientRect()\n  #.........................................................................................................\n  for rectangle, idx in element.getClientRects()\n    scroll_top                = 0 # -element.scrollTop\n    scroll_left               = 0 # -element.scrollLeft\n    # scroll_top                = µ.DOM.get_document_scroll_top()\n    # scroll_left               = µ.DOM.get_document_scroll_left()\n    marker_top                = rectangle.top     - ref_rectangle.top  + ref_element.scrollTop\n    if idx is 0\n      debug '^123-1^', marker_top, rectangle.top, ref_rectangle.top, ref_element.scrollTop\n    marker_left               = rectangle.left    - ref_rectangle.left\n    marker_width              = rectangle.width\n    marker_height             = rectangle.height\n    marker_bottom             = marker_top        + marker_height\n    marker                    = µ.DOM.parse_one \"<div>#{marker_top.toFixed 0}px</div>\"\n    marker.style.top          = \"#{ marker_top    }px\"\n    marker.style.left         = \"#{ marker_left   }px\"\n    marker.style.width        = \"#{ marker_width  }px\"\n    marker.style.height       = \"#{ marker_height }px\"\n    marker.style.paddingLeft  = \"#{ marker_width  }px\"\n    µ.DOM.add_class marker, 'µ-clientrec'\n    µ.DOM.add_class marker, 'above' if marker_top     < 0\n    µ.DOM.add_class marker, 'below' if marker_bottom  > ref_rectangle.height\n    ref_element.appendChild marker\n  # µ.DOM.remove m2 for m2 in µ.DOM.select_all_from ref_element, '.µ-clientrec.ref-rectangle'\n  # m2 = document.createElement 'div'\n  # µ.DOM.add_class m2, 'µ-clientrec'\n  # µ.DOM.add_class m2, 'ref-rectangle'\n  # m2.style.top    = \"#{0}px\"\n  # m2.style.left   = \"#{0}px\"\n  # m2.style.width  = \"#{ref_rectangle.width}px\"\n  # m2.style.height = \"#{ref_rectangle.height}px\"\n  # ref_element.appendChild m2\n  return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# draw_client_rectangles = =>\n#   ref_elements = µ.DOM.select_all '.tracker'\n#   for ref_element in ref_elements\n#     debug \"draw_client_rectangles for ref_element\", ref_element\n#     elements = µ.DOM.select_all_from ref_element, '& > div > span'\n#     for element in elements\n#       # debug '^123-2^', element\n#       add_line_markers ref_element, element\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# do ->\n#   for element in µ.DOM.select_all '.tracker > div'\n#     µ.DOM.wrap_inner element, µ.DOM.parse_one '<span></span>'\n#   return null\n\n\n#===========================================================================================================\nclass Aligner\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ->\n    @_insert_spans()\n    @_mark_line_rectangles()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _insert_spans: ->\n    ### all relevant iframes show the same underlying document so we only add spans for the document in the\n    first iframe ###\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    for element in first_tracker.querySelectorAll ':scope > div'\n      debug '^123-3^', element\n      µ.DOM.wrap_inner element, µ.DOM.parse_one \"<span class='µ-aligner'></span>\"\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _mark_line_rectangles: ->\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    debug \"draw_client_rectangles for first_tracker\", first_tracker\n    elements = first_tracker.querySelectorAll ':scope > div > span'\n    for element in elements\n      debug '^123-4^', element\n      add_line_markers first_tracker, element\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _xxx: ->\n    ###\n\n    entities:\n\n      * iframes / target boxes\n        * linearly ordered so text flows from one to the next\n          * each with width, height, position on page\n        * for now:\n          * no automatic creation\n          * width held constant across iframes\n          * position on page irrelevant\n\n      * tracker / galley:\n        * has same width as targetted iframe\n        * has margins above, below of at least the maximum target height\n        * extensions:\n          * when one flow should go into targets with differing widths, need to add\n            `float`ing `div`s that restrict line lengths intermittently in the galley\n          * may consider to do that line-by-line so that ['Form' / 'Kontur'satz](https://de.wikipedia.org/wiki/Kontursatz)\n            is already being thought of\n\n\n    ###\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    debug \"draw_client_rectangles for first_tracker\", first_tracker\n    elements = first_tracker.querySelectorAll ':scope > div > span'\n    for element in elements\n      debug '^123-4^', element\n      add_line_markers first_tracker, element\n    return null\n\n\n#===========================================================================================================\nµ.DOM.ready ->\n  log '^123-5^', \"ready\"\n  aligner = new Aligner()\n  iframes = µ.DOM.select_all 'iframe'\n  for iframe in iframes\n    sub_document  = iframe.contentDocument\n    # first_tracker = µ.DOM.select_first_from sub_document, '.tracker'\n    first_tracker = sub_document.querySelector '.tracker'\n    debug '^35345^', first_tracker\n    iframe.contentWindow.scrollTo 0, 200\n  #   # sub_document.scrollTo 0, 100\n  #   # first_tracker.scrollTop = 100\n  #   draw_client_rectangles()\n  button  = µ.DOM.select_first '#redraw'\n  µ.DOM.on button, 'click', ->\n    debug '^123-6^', \"redraw\"\n    draw_client_rectangles()\n  # #.........................................................................................................\n  # log '^123-7^', \"set up scroll events\"\n  # show_scroll_tops = ->\n  #   doc_scroll_top      = µ.DOM.get_document_scroll_top().toFixed 0\n  #   tracker_scroll_top  = first_tracker.scrollTop.toFixed 0\n  #   log '^123-8^', 'scroll', doc_scroll_top, tracker_scroll_top\n  #   return null\n  # µ.DOM.on document,      'scroll', show_scroll_tops\n  # µ.DOM.on first_tracker, 'scroll', show_scroll_tops\n  # handler = ->\n  #   log '^123-9^', 'scroll tracker'\n  # ( µ.DOM.select_first '.tracker' ).addEventListener 'scroll', handler, true\n  return null\n\n\nlog '^123-10^', \"ops2 OK\""
  ]
}