{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/ops2.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\nglobalThis.log = console.log\nglobalThis.debug = console.debug\n\n\n#-----------------------------------------------------------------------------------------------------------\nadd_line_markers = ( ref_element, element ) ->\n  debug 'add_line_markers', element\n  # debug '^32342^', µ.DOM.select_all_from element, '.µ-clientrec'\n  µ.DOM.remove marker for marker in µ.DOM.select_all_from element, '.µ-clientrec'\n  #.........................................................................................................\n  ref_rectangle = ref_element.getBoundingClientRect()\n  #.........................................................................................................\n  for rectangle, idx in element.getClientRects()\n    scroll_top                = 0 # -element.scrollTop\n    scroll_left               = 0 # -element.scrollLeft\n    # scroll_top                = µ.DOM.get_document_scroll_top()\n    # scroll_left               = µ.DOM.get_document_scroll_left()\n    marker_top                = rectangle.top     - ref_rectangle.top  + ref_element.scrollTop\n    # if idx is 0\n    #   debug '^123-1^', marker_top, rectangle.top, ref_rectangle.top, ref_element.scrollTop\n    marker_left               = rectangle.left    - ref_rectangle.left\n    marker_width              = rectangle.width\n    marker_height             = rectangle.height\n    marker_bottom             = marker_top        + marker_height\n    # marker                    = µ.DOM.parse_one \"<div>#{marker_top.toFixed 0}px</div>\"\n    marker                    = µ.DOM.parse_one \"<div></div>\"\n    marker.style.top          = \"#{ marker_top    }px\"\n    marker.style.left         = \"#{ marker_left   }px\"\n    marker.style.width        = \"#{ marker_width  }px\"\n    marker.style.height       = \"#{ marker_height }px\"\n    marker.style.paddingLeft  = \"#{ marker_width  }px\"\n    µ.DOM.add_class marker, 'µ-clientrec'\n    µ.DOM.add_class marker, 'above' if marker_top     < 0\n    µ.DOM.add_class marker, 'below' if marker_bottom  > ref_rectangle.height\n    ref_element.appendChild marker\n  # µ.DOM.remove m2 for m2 in µ.DOM.select_all_from ref_element, '.µ-clientrec.ref-rectangle'\n  # m2 = document.createElement 'div'\n  # µ.DOM.add_class m2, 'µ-clientrec'\n  # µ.DOM.add_class m2, 'ref-rectangle'\n  # m2.style.top    = \"#{0}px\"\n  # m2.style.left   = \"#{0}px\"\n  # m2.style.width  = \"#{ref_rectangle.width}px\"\n  # m2.style.height = \"#{ref_rectangle.height}px\"\n  # ref_element.appendChild m2\n  return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# draw_client_rectangles = =>\n#   ref_elements = µ.DOM.select_all '.tracker'\n#   for ref_element in ref_elements\n#     debug \"draw_client_rectangles for ref_element\", ref_element\n#     elements = µ.DOM.select_all_from ref_element, '& > div > span'\n#     for element in elements\n#       # debug '^123-2^', element\n#       add_line_markers ref_element, element\n#   return null\n\n# #-----------------------------------------------------------------------------------------------------------\n# do ->\n#   for element in µ.DOM.select_all '.tracker > div'\n#     µ.DOM.wrap_inner element, µ.DOM.parse_one '<span></span>'\n#   return null\n\n\n#===========================================================================================================\nclass Aligner\n\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ->\n    @_insert_spans()\n    @_mark_line_rectangles()\n    @_xxx()\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _insert_spans: ->\n    ### all relevant iframes show the same underlying document so we only add spans for the document in the\n    first iframe ###\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    for element in first_tracker.querySelectorAll ':scope > div'\n      # debug '^123-3^', element\n      µ.DOM.wrap_inner element, µ.DOM.parse_one \"<span class='µ-aligner'></span>\"\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _mark_line_rectangles: ->\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ### `:scope` is akin to `this`, refers to present element;\n    thx to https://stackoverflow.com/a/17206138/7568091 ###\n    debug \"draw_client_rectangles for first_tracker\", first_tracker\n    elements = first_tracker.querySelectorAll ':scope > div > span'\n    for element in elements\n      # debug '^123-4^', element\n      add_line_markers first_tracker, element\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  _xxx: ->\n    ###\n\n    entities:\n\n      * iframes / target boxes\n        * linearly ordered so text flows from one to the next\n          * each with width, height, position on page\n        * for now:\n          * no automatic creation\n          * width held constant across iframes\n          * position on page irrelevant\n\n      * galley:\n        * has maximum width of all target frames\n        * has margins above, below of at least the maximum target height\n        * extensions:\n          * when one flow should go into targets with differing widths, need to add\n            floating divs left and right to constrain and position lines using CSS\n            `shape-outside` (and analogous `clip-path` for visualization)\n            `d.style.setProperty( '--path', getComputedStyle(d).getPropertyValue('--path') + ', 20mm 50mm' )`\n\n    ###\n    first_iframe  = µ.DOM.select_first 'iframe'\n    sub_document  = first_iframe.contentDocument\n    ### NB µDOM rejects sub_document b/c not considered an 'element', may change that ###\n    first_tracker = sub_document.querySelector '.tracker'\n    ref_element   = first_tracker\n    ref_rectangle = ref_element.getBoundingClientRect()\n    elements      = first_tracker.querySelectorAll ':scope > div > span'\n    for element in elements\n      debug '^123-5^', element\n      for rectangle, idx in element.getClientRects()\n        scroll_top                = 0 # -element.scrollTop\n        scroll_left               = 0 # -element.scrollLeft\n        # scroll_top                = µ.DOM.get_document_scroll_top()\n        # scroll_left               = µ.DOM.get_document_scroll_left()\n        marker_top                = rectangle.top     - ref_rectangle.top  + ref_element.scrollTop\n        if idx is 0\n          debug '^123-6^', marker_top, rectangle.top, ref_rectangle.top, ref_element.scrollTop\n        marker_left               = rectangle.left    - ref_rectangle.left\n        marker_width              = rectangle.width\n        marker_height             = rectangle.height\n        marker_bottom             = marker_top        + marker_height\n    return null\n\n\n#===========================================================================================================\nglobalThis.draw_line_boxes = ( nodes = null ) ->\n  nodes        ?= document.querySelectorAll 'galley > div'\n  log '^123-12^', nodes\n  rectangles    = []\n  linefinder    = new µ.LINEFINDER.Linefinder()\n  for node in nodes\n    # log '^123-4^', ( d for d from linefinder.walk_line_rectangles_of_node node )\n    for rectangle from linefinder.walk_line_rectangles_of_node node\n      rectangles.push rectangle\n      linefinder.draw_box rectangle\n  ref_top = document.documentElement.scrollTop\n  return { rectangles, ref_top, }\n\n\n#===========================================================================================================\nµ.DOM.ready ->\n  log '^123-7^', \"ready\"\n  #.........................................................................................................\n  for iframe in µ.DOM.select_all 'iframe'\n    µ.DOM.set iframe, 'scrolling', 'true'\n  #.........................................................................................................\n  if µ.DOM.page_is_inside_iframe()\n    log '^123-7^', \"leaving b/c document is loaded in iframe\"\n    return null\n  # log '^123-9^', 'page_is_inside_iframe', window.parent\n  # log '^123-10^', µ.DOM.select_first 'galley', null\n  galley_iframe     = µ.DOM.select_first 'iframe', null\n  unless galley_iframe?\n    log '^123-7^', \"leaving b/c document does not have galley\"\n    return null\n  galley_document   = galley_iframe.contentDocument\n  galley_window     = galley_iframe.contentWindow\n  galley_window.scrollTo { top: 500, }\n  # galley            = µ.DOM.select_first_from galley_document, 'galley'\n  log '^123-11^', galley_document.querySelector 'galley'\n  log '^123-11^', galley_window.draw_line_boxes()\n  return null\n  aligner = new Aligner()\n  iframes = µ.DOM.select_all 'iframe'\n  for iframe in iframes\n    sub_document  = iframe.contentDocument\n    # first_tracker = µ.DOM.select_first_from sub_document, '.tracker'\n    first_tracker = sub_document.querySelector '.tracker'\n    debug '^35345^', first_tracker\n    iframe.contentWindow.scrollTo 0, 200\n  #   # sub_document.scrollTo 0, 100\n  #   # first_tracker.scrollTop = 100\n  #   draw_client_rectangles()\n  button  = µ.DOM.select_first '#redraw'\n  µ.DOM.on button, 'click', ->\n    debug '^123-13^', \"redraw\"\n    draw_client_rectangles()\n  # #.........................................................................................................\n  # log '^123-14^', \"set up scroll events\"\n  # show_scroll_tops = ->\n  #   doc_scroll_top      = µ.DOM.get_document_scroll_top().toFixed 0\n  #   tracker_scroll_top  = first_tracker.scrollTop.toFixed 0\n  #   log '^123-15^', 'scroll', doc_scroll_top, tracker_scroll_top\n  #   return null\n  # µ.DOM.on document,      'scroll', show_scroll_tops\n  # µ.DOM.on first_tracker, 'scroll', show_scroll_tops\n  # handler = ->\n  #   log '^123-16^', 'scroll tracker'\n  # ( µ.DOM.select_first '.tracker' ).addEventListener 'scroll', handler, true\n  return null\n\n\n\n"
  ]
}